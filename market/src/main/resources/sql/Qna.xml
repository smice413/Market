<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="qnans">

	<select id="list" parameterType="qna" resultType="qna">
		select * from (select a.*,rowNum rn from (
			select 
				Q.qna_no as qna_no,
				Q.p_no as p_no,
				Q.op_no as op_no,
				Q.m_email as m_email,
				Q.qna_title as qna_title,
				Q.qna_question as qna_question,
				Q.qna_answer as qna_answer,
				Q.qna_ref as qna_ref,
				Q.qna_secret as qna_secret,
				Q.s_no as s_no,
				Q.qna_writedate as qna_writedate,
				Q.qna_delstatus as qna_delstatus,
				M.m_name as m_name,
				P.p_name as p_name,
				OP.o_no as o_no
			from qna Q 
			   	left join member M on M.m_email = Q.m_email
			   	left join product P on P.p_no = Q.p_no
			   	left join order_product OP on OP.op_no = Q.op_no
	    <choose>
	        <when test="search == 'p_no'"> where Q.p_no=#{keyword} </when>
	        <when test="search == 's_no'"> where Q.s_no=#{keyword} </when>
	        <when test="search == 'm_email'"> where Q.m_email=#{keyword} </when>
		</choose>
			 order by qna_ref asc, qna_writedate asc ) a)
			where rn between #{startRow} and #{endRow}
	</select>
	
	
	<select id="getTotal" parameterType="qna" resultType="int">
 		select count(*) from qna
 	    <choose>
	        <when test="search == 'p_no'"> where p_no=#{keyword} </when>
	        <when test="search == 's_no'"> where s_no=#{keyword} </when>
	        <when test="search == 'm_email'"> where m_email=#{keyword} </when>
		</choose>
	</select>
	
	<select id="select" parameterType="int" resultType="qna">
 		select * from qna where qna_no=#{qna_no}
	</select>

	
	<select id="getMaxNum" resultType="int">
<!-- 		select nvl(max(qna_no),0) + 1 from qna
 -->	</select>
	
	<insert id="insert" parameterType="qna">
		insert into qna values (qna_seq.nextval,#{p_no},#{op_no},
			#{m_email},#{qna_title},#{qna_question},#{qna_answer},qna_seq.nextval,
			#{qna_secret},#{s_no},sysdate,'N')
	</insert>
	
	<update id="answer" parameterType="int">
 		update qna set qna_answer=#{qna_answer} where qna_no=#{qna_no}
	</update>
		
	<update id="update" parameterType="qna">
<!-- 		update qna set qna_title=#{qna_title},qna_question=#{qna_question},
			qna_answer=#{qna_answer},qna_secret=#{qna_secret} 
			where qna_no=#{qna_no} -->
	</update>
	
	<update id="delete" parameterType="int">
<!-- 		update qna set qna_del='y' where qna_no=#{qna_no} -->
	</update>

</mapper>