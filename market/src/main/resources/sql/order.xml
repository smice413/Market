<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="orderpagens">
	
	<!-- 주문 상품 목록 조회 -->
 	<select id="getProductInfo" resultType="orderpage">
		select c.*, p.*,s.s_name,pi.p_img from cart c, product p, shop s, product_img pi where c.p_no=p.p_no 
		and p.s_no=s.s_no and p.p_no=pi.p_no and pi.p_img_order=1 
		and cart_no = #{cart_no} order by p.p_name
	</select>
	
	<!-- 주문자 기본배송지 조회 -->
	<select id="getDeliveryInfo" parameterType="String" resultType="delivery">
		select * from delivery where m_email=#{m_email} and d_default='Y' and d_delstatus='N' 
	</select>	
	
	<!-- 등록된 배송지 주소 개수-->
	<select id="getAddressCount" parameterType="String" resultType="int">
		select count(*) from delivery where m_email=#{m_email} and d_delstatus='N' 
	</select>
	
	<!-- 배송지 등록 -->
	<insert id="deliveryInsert" parameterType="delivery">
		insert into delivery values(delivery_seq.nextval,#{m_email},#{d_name},#{d_tel},
		#{d_cate},#{d_post},#{d_address},'N',#{d_detail_address},'N')
	</insert>
	
	<!-- 배송지 목록 조회 -->
	<select id="getDeliveryList" parameterType="String" resultType="delivery"> 
		select * from delivery where m_email=#{m_email} and d_delstatus = 'N'
	</select>
	
	<!-- 기본 배송지 d_default값 변경 -->
	<!-- Y -> N -->
	<update id="UpdateDefaultN" parameterType="String">
		update delivery set d_default = 'N' where m_email=#{m_email} and d_default='Y' 
	</update>
	<!-- N -> Y -->	
	<update id="UpdateDefaultY" parameterType="int">
		update delivery set d_default = 'Y' where d_no = #{d_no} 
	</update>

	<!--수정을 위한 배송지 조회 -->
	<select id="getDelivery" parameterType="int" resultType="delivery">
		select * from delivery where d_no=#{d_no}
	</select>
	
	<!-- 배송지 수정  -->
	<update id="addressUpdate" parameterType="delivery">
		update delivery set d_name=#{d_name},d_tel=#{d_tel},d_cate=#{d_cate},d_post=#{d_post},
		d_address=#{d_address},d_detail_address=#{d_detail_address} where d_no=#{d_no}
	</update>
	
	<!-- 배송지 삭제 -->
	<delete id="deleteAddr" parameterType="int">
		update delivery set d_delstatus = 'Y' where d_no = #{d_no}
	</delete>

	
	
	
</mapper>