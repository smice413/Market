<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="order_product">

<!-- 주문상품 목록 -->

<select id="orderlist" resultType="order_product">
select 
    OP.op_no as op_no,
    OP.o_no as o_no,
    OP.op_type as op_type,
    OP.op_qty as op_qty,
    OP.op_price as op_price,
    OP.op_status as op_status,
    OT.o_date as o_date,
    PI.p_img as p_img,
    P.p_name as p_name
    
from order_product OP
    left join product P on OP.p_no = P.p_no
    left join order_tab OT on OP.o_no = OT.o_no
    left join product_img PI on OP.p_no = PI.p_no

where m_email = 'hamtori@gmail.com' order by o_date desc
</select>

<!-- 주문 상세  -->
<select id="orderdetail" parameterType="int" resultType="order_product">
select
    OT.o_no as o_no,
    OT.d_msg as d_msg,
    OT.o_total_price as o_total_price,
    OT.o_sale_price as o_sale_price,
    OT.o_deli_price as o_deli_price,
    OT.o_pay_price as o_pay_price,
    OT.o_pay_type as o_pay_type,
    OT.o_date as o_date,
    D.d_name as d_name,
    D.d_tel as d_tel,
    D.d_post as d_post,
    D.d_address as d_address,
    OP.op_no as op_no,
    OP.op_type as op_type,
    OP.op_qty as op_qty,
    OP.op_price as op_price,
    OP.op_status as op_status

from order_tab OT
    left join delivery D on OT.d_no = D.d_no
     left join order_product OP on OT.o_no = OP.o_no

where OP.op_no = #{op_no}
</select>


<!-- 주문 취소 -->
<update id="cancel" parameterType="int">
	update order_product set op_status = '4', op_cancel_date = sysdate where op_no = #{op_no}
</update>

<!-- 환불 사유 DB 저장 -->
<update id="refundForm" parameterType="order_product">
	update order_product set op_refund_why = #{op_refund_why}, op_status = '8' where op_no = #{op_no}
</update>

</mapper>